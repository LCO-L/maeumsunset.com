<!doctype html>
<html lang="ko">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ìº í”„íŒŒì´ì–´ ì €ë„ â€” ì´ˆê²½ëŸ‰</title>
<style>
  :root{--bg:#0b0f14;--card:#11171f;--ink:#eaeef3;--ring:#2b3442;--accent:#ffc27a}
  *{box-sizing:border-box}html,body{height:100%}body{margin:0;background:#0b0f14;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif}
  .wrap{max-width:920px;margin:20px auto;padding:0 12px}
  .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:12px;margin-bottom:12px}
  .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .btn{appearance:none;border:1px solid var(--ring);background:#151c25;color:var(--ink);padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
  .grid{display:grid;grid-template-columns:repeat(1,1fr);gap:10px}
  @media(min-width:720px){.grid{grid-template-columns:repeat(3,1fr)}}
  .camp{position:relative;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:10px;background:linear-gradient(180deg,rgba(18,23,30,.7),rgba(12,16,22,.8))}
  .campHead{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
  .campStats{color:var(--accent);font-weight:800}
  .campArt{height:180px;border-radius:12px;background:#0b0f14;display:flex;align-items:center;justify-content:center;overflow:hidden;border:1px solid rgba(255,255,255,.06)}
  .campArt svg{width:100%;height:100%}
  .hidden{display:none}
  .toast{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:#111821;color:#fff;padding:8px 12px;border-radius:10px;opacity:0;transition:.2s}
  .toast.show{opacity:1}
  textarea{width:100%;min-height:110px;background:#0c1117;color:var(--ink);border:1px solid var(--ring);border-radius:12px;padding:12px}
</style>
<body>
  <div class="wrap">
    <div class="card"><div class="row"><strong>ğŸ”¥ ìº í”„íŒŒì´ì–´</strong><span id="today"></span></div></div>
    <div class="card">
      <div class="row"><h3 style="margin:0">ì˜¤ëŠ˜ì˜ ìº í”„</h3><button id="editBtn" class="btn">ì£¼ì œ í¸ì§‘</button></div>
      <div id="grid" class="grid"></div>
    </div>

    <div id="room" class="card hidden">
      <div class="row">
        <h3 id="roomTitle" style="margin:0"></h3>
        <div style="display:flex;gap:8px">
          <button id="backBtn" class="btn">ëª©ë¡ìœ¼ë¡œ</button>
          <button id="renameBtn" class="btn">ì£¼ì œ ë°”ê¾¸ê¸°</button>
        </div>
      </div>
      <div class="card">
        <textarea id="journal" placeholder="ì—¬ê¸°ì— ì˜¤ëŠ˜ì˜ ë…¸íŠ¸ë¥¼ ì ì–´ì£¼ì„¸ìš”."></textarea>
        <div class="row"><div id="len" style="opacity:.8">0ì</div><button id="saveBtn" class="btn">ì €ì¥</button></div>
      </div>
      <div id="posts"></div>
    </div>
  </div>
  <div id="toast" class="toast"></div>

<script>
  // ì´ˆê²½ëŸ‰ ì…¸: SVGë§Œ ê·¸ë¦¬ê³ , í´ë¦­ ì‹œ app.jsë¥¼ ë™ì  ë¡œë“œí•˜ì—¬ ê¸°ëŠ¥ í™œì„±í™”
  const $=s=>document.querySelector(s);
  const today = new Date().toISOString().slice(0,10);
  $('#today').textContent = today;

  function getTopics(){
    try{ const v = localStorage.getItem('camp_topics:'+today); if(v) return JSON.parse(v);}catch(e){}
    const t=[{id:0,title:"ì˜¤ëŠ˜ì˜ í•˜ì´ë¼ì´íŠ¸"},{id:1,title:"ì§€ê¸ˆ ë‚´ ê°ì •"},{id:2,title:"ë‚´ê°€ ì„ íƒí•  ì‘ì€ í–‰ë™"}];
    try{ localStorage.setItem('camp_topics:'+today, JSON.stringify(t)); }catch(e){}
    return t;
  }
  let TOPICS = getTopics();

  const FIRE_SVG = (seed=0)=>`<svg viewBox="0 0 320 180" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="ìº í”„íŒŒì´ì–´">
    <defs>
      <radialGradient id="g${seed}" cx="50%" cy="70%" r="60%">
        <stop offset="0%" stop-color="rgba(255,240,220,0.95)"/>
        <stop offset="35%" stop-color="rgba(255,165,80,0.8)"/>
        <stop offset="70%" stop-color="rgba(255,110,40,0.4)"/>
        <stop offset="100%" stop-color="rgba(0,0,0,0)"/>
      </radialGradient>
    </defs>
    <rect width="100%" height="100%" fill="#0b0f14"/>
    <ellipse cx="160" cy="150" rx="120" ry="18" fill="rgba(255,180,100,0.18)"/>
    <ellipse cx="160" cy="110" rx="60" ry="70" fill="url(#g${seed})"/>
    <g opacity=".9" transform="translate(0,8)">
      <rect x="90" y="132" width="140" height="10" rx="5" fill="#6b4e3a"/>
      <rect x="90" y="132" width="140" height="10" rx="5" fill="#8c6348" transform="rotate(-12 160 137)"/>
    </g>
    <ellipse cx="160" cy="150" rx="140" ry="24" fill="#444a52"/>
  </svg>`;

  function renderGrid(){
    const grid = $('#grid'); grid.innerHTML='';
    for(let i=0;i<3;i++){
      const div=document.createElement('div'); div.className='camp';
      const topic = TOPICS[i]?.title || ('ìº í”„ '+(i+1));
      div.innerHTML = \`
        <div class="campHead">
          <div style="font-weight:800">\${topic}</div>
          <div class="campStats" id="stat\${i}">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
        </div>
        <div class="campArt">\${FIRE_SVG(i)}</div>
        <div class="row" style="margin-top:8px">
          <button class="btn" data-open="\${i}">ì—´ê¸°</button>
        </div>\`;
      grid.appendChild(div);
    }
  }

  function toast(m){ const t=$('#toast'); t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1200); }

  renderGrid();
  // ë™ì  ë¡œë“œ: ì²« ìƒí˜¸ì‘ìš© ì‹œ app.js import â†’ ë¬´ê±°ìš´ ë¡œì§ì€ ë’¤ë¡œ
  let appLoaded=false, app=null;
  async function ensureApp(){
    if(appLoaded) return app;
    appLoaded=true;
    app = await import('./app.js'); // ëª¨ë“ˆ ë¡œë“œ
    // í†µê³„ í‘œì‹œ ì—…ë°ì´íŠ¸
    for(let i=0;i<3;i++){
      const roomId = app.getRoomId(i);
      const data = app.loadRoom(roomId);
      const likes = (data.answers||[]).reduce((a,b)=>a+(b.likes||0),0);
      document.getElementById('stat'+i).textContent = 'â¤ï¸ '+likes+' Â· ë…¸íŠ¸ '+(data.answers?.length||0);
    }
    return app;
  }

  // ì´ë²¤íŠ¸ ìœ„ì„
  document.addEventListener('click', async (e)=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    if(btn.id==='editBtn'){
      const cur = TOPICS.map(t=>t.title).join('\n');
      const next = prompt('ì„¸ ì¤„ë¡œ ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”', cur);
      if(!next) return;
      const parts = next.split(/\r?\n/).filter(Boolean).slice(0,3);
      while(parts.length<3) parts.push('ìº í”„ '+(parts.length+1));
      TOPICS = parts.map((t,i)=>({id:i,title:t.trim()}));
      localStorage.setItem('camp_topics:'+today, JSON.stringify(TOPICS));
      renderGrid(); // ì œëª© ì¦‰ì‹œ ë°˜ì˜
      // í†µê³„ëŠ” app.js ë¡œë“œ í›„ ê°±ì‹ 
      try{ await ensureApp(); }catch{}
      return;
    }
    if(btn.dataset.open){
      const idx = +btn.dataset.open;
      const mod = await ensureApp();
      mod.openCamp(idx); // app.jsê°€ ë°© í™”ë©´ ë Œë”ë§
      return;
    }
  });
</script>
</body>
</html>
